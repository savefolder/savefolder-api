# Bootstrap image

FROM alpine:latest as bootstrap
LABEL stage=bootstrap
WORKDIR /app

COPY . .
RUN apk update && apk add --update git
RUN git archive HEAD -v -o files.tar
RUN mkdir files && tar xf files.tar -C files

# Final image

FROM python:latest
WORKDIR /app
EXPOSE 80

COPY --from=bootstrap /app/files/. .
RUN pip install -r requirements.txt
CMD ["python", "-u", "app.py"]
